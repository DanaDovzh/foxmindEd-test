import{a as V}from"./chunk-Z5EOS67G.js";import{a as A}from"./chunk-K34KL4Q3.js";import{a as z,b as D}from"./chunk-3EAYMFXH.js";import{$a as w,Da as y,Ra as a,S as d,Sa as n,Ta as x,U as g,Ub as O,V as h,Xa as I,_a as _,ac as P,db as E,e as R,eb as M,fb as b,ma as m,nb as r,ob as L,pb as c,ta as u,va as v,wb as f,xa as C,xb as S,yb as k,zb as T}from"./chunk-XBVD5SFW.js";var i=R(A());var $=["popupTemplate"];function N(p,t){if(p&1){let e=I();a(0,"div",2)(1,"p",3),r(2),n(),a(3,"p",4)(4,"span",5),r(5,"\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0456\u044F:"),n(),r(6),f(7,"categoryLabel"),n(),a(8,"p",4)(9,"span",5),r(10,"\u0412\u0430\u0436\u043A\u0456\u0441\u0442\u044C:"),n(),r(11),n(),a(12,"p",4)(13,"span",5),r(14,"\u0414\u0430\u0442\u0430:"),n(),r(15),f(16,"date"),n(),a(17,"button",6),_("click",function(){let o=g(e).$implicit,l=w();return h(l.openIncident(o.id))}),r(18,"\u0414\u0435\u0442\u0430\u043B\u0456"),n()()}if(p&2){let e=t.$implicit;m(2),L(e.title),m(4),c(" ",S(7,4,e.category)),m(5),c(" ",e.severity),m(4),c(" ",k(16,6,e.createdAt,"medium"))}}window.L=i;var F=class p{constructor(t,e){this._filterService=t;this._incidentsService=e}viewContainerRef=d(v);router=d(P);markerCluster;incidentsData=[];map;options={zoom:8,center:i.latLng(50.4501,30.5234),layers:[i.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'})]};popupTemplate;ngOnInit(){this.subscribeToFilterChanges()}ngAfterViewInit(){this.initMap(),setTimeout(()=>{this.map.invalidateSize()},0)}getIncidents(){this._incidentsService.loadData(this._filterService.currentFilters).subscribe(t=>{this.incidentsData=t,this.addMarkers()})}subscribeToFilterChanges(){this._filterService.filters$.subscribe(()=>{this.getIncidents()})}initMap(){this.map=i.map("map",{zoom:13,center:i.latLng(50.4501,30.5234),layers:[i.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'})]})}addMarkers(){this.markerCluster&&this.map.removeLayer(this.markerCluster),this.markerCluster=window.L.markerClusterGroup(),this.incidentsData.forEach(t=>{let e=i.divIcon({html:`
        <div style="display: flex; flex-direction: column; align-items: center;">
          <img src="assets/leaflet/marker-icon.png" style="width: 25px; height: 41px;" />
          <span style="font-size: 12px; color: black; margin-top: 4px;">${t.category}</span>
        </div>
      `,iconSize:[25,55],className:""}),s=this.viewContainerRef.createEmbeddedView(this.popupTemplate,{$implicit:t}),o=document.createElement("div");s.rootNodes.forEach(l=>o.appendChild(l)),i.marker([t.location.lat,t.location.lng],{alt:t.category,icon:e}).addTo(this.markerCluster).bindPopup(o)}),this.map.addLayer(this.markerCluster)}openIncident(t){this.router.navigate(["/incident",t])}static \u0275fac=function(e){return new(e||p)(u(V),u(D))};static \u0275cmp=C({type:p,selectors:[["app-incidents-map"]],viewQuery:function(e,s){if(e&1&&E($,5),e&2){let o;M(o=b())&&(s.popupTemplate=o.first)}},decls:3,vars:0,consts:[["popupTemplate",""],["id","map"],[1,"incident-popup"],[1,"popup-title"],[1,"parameter"],[1,"parameter-name"],[3,"click"]],template:function(e,s){e&1&&(x(0,"div",1),y(1,N,19,9,"ng-template",null,0,T))},dependencies:[O,z],styles:["#map[_ngcontent-%COMP%]{width:550px;height:500px;border-radius:20px}.incident-popup[_ngcontent-%COMP%]   .popup-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;text-align:center}.incident-popup[_ngcontent-%COMP%]   .parameter[_ngcontent-%COMP%]{margin:2px 0}.incident-popup[_ngcontent-%COMP%]   .parameter-name[_ngcontent-%COMP%]{font-weight:600}"]})};export{F as IncidentsMapComponent};
